/*
 * -----------------------------------------------------------------------------
 * This file is part of the browser implementation of the Heroes of Crypto game client.
 *
 * Heroes of Crypto and Heroes of Crypto AI are registered trademarks.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 * -----------------------------------------------------------------------------
 */

import book_1024 from "../../../images/book_1024.webp";
import back from "../../../images/background_dark.webp";
import frame_black_512 from "../../../images/frame_black_512.webp";
import green_flag_70 from "../../../images/green_flag_70.webp";
import red_flag_70 from "../../../images/red_flag_70.webp";
import green_flag_128 from "../../../images/green_flag_128.webp";
import red_flag_128 from "../../../images/red_flag_128.webp";
import life_128 from "../../../images/life_128.webp";
import nature_128 from "../../../images/nature_128.webp";
import order_128 from "../../../images/order_128.webp";
import might_128 from "../../../images/might_128.webp";
import chaos_128 from "../../../images/chaos_128.webp";
import death_128 from "../../../images/death_128.webp";
import death_locked_128 from "../../../images/death_locked_128.webp";
import life_512 from "../../../images/life_512.webp";
import nature_512 from "../../../images/nature_512.webp";
import order_512 from "../../../images/order_512.webp";
import might_512 from "../../../images/might_512.webp";
import chaos_512 from "../../../images/chaos_512.webp";
import death_512 from "../../../images/death_512.webp";
import double_punch_256 from "../../../images/double_punch_256.webp";
import backstab_256 from "../../../images/backstab_256.webp";
import double_shot_256 from "../../../images/double_shot_256.webp";
import sniper_256 from "../../../images/sniper_256.webp";
import leather_armor_256 from "../../../images/leather_armor_256.webp";
import limited_supply_256 from "../../../images/limited_supply_256.webp";
import undead_256 from "../../../images/undead_256.webp";
import made_of_bones_256 from "../../../images/made_of_bones_256.webp";
import taxpayer_256 from "../../../images/taxpayer_256.webp";
import fire_vulnerability_256 from "../../../images/fire_vulnerability_256.webp";
import luck_aura_256 from "../../../images/luck_aura_256.webp";
import fire_element_256 from "../../../images/fire_element_256.webp";
import stun_256 from "../../../images/stun_256.webp";
import handyman_256 from "../../../images/handyman_256.webp";
import endless_quiver_256 from "../../../images/endless_quiver_256.webp";
import one_in_the_field_256 from "../../../images/one_in_the_field_256.webp";
import shadow_touch_256 from "../../../images/shadow_touch_256.webp";
import wild_regeneration_256 from "../../../images/wild_regeneration_256.webp";
import enchanted_skin_256 from "../../../images/enchanted_skin_256.webp";
import lightning_spin_256 from "../../../images/lightning_spin_256.webp";
import fire_breath_256 from "../../../images/fire_breath_256.webp";
import fire_shield_256 from "../../../images/fire_shield_256.webp";
import small_specie_256 from "../../../images/small_specie_256.webp";
import boost_health_256 from "../../../images/boost_health_256.webp";
import piercing_spear_256 from "../../../images/piercing_spear_256.webp";
import heavy_armor_256 from "../../../images/heavy_armor_256.webp";
import no_melee_256 from "../../../images/no_melee_256.webp";
import arbalester_128 from "../../../images/arbalester_128.webp";
import arbalester_512 from "../../../images/arbalester_512.webp";
import squire_128 from "../../../images/squire_128.webp";
import squire_512 from "../../../images/squire_512.webp";
import peasant_128 from "../../../images/peasant_128.webp";
import peasant_512 from "../../../images/peasant_512.webp";
import pikeman_128 from "../../../images/pikeman_128.webp";
import pikeman_512 from "../../../images/pikeman_512.webp";
import crusader_128 from "../../../images/crusader_128.webp";
import crusader_512 from "../../../images/crusader_512.webp";
import griffin_128 from "../../../images/griffin_128.webp";
import griffin_512 from "../../../images/griffin_512.webp";
import tsar_cannon_256 from "../../../images/tsar_cannon_256.webp";
import tsar_cannon_512 from "../../../images/tsar_cannon_512.webp";
import angel_256 from "../../../images/angel_256.webp";
import angel_512 from "../../../images/angel_512.webp";
import fairy_128 from "../../../images/fairy_128.webp";
import fairy_512 from "../../../images/fairy_512.webp";
import wolf_128 from "../../../images/wolf_128.webp";
import wolf_512 from "../../../images/wolf_512.webp";
import leprechaun_128 from "../../../images/leprechaun_128.webp";
import leprechaun_512 from "../../../images/leprechaun_512.webp";
import white_tiger_128 from "../../../images/white_tiger_128.webp";
import white_tiger_512 from "../../../images/white_tiger_512.webp";
import elf_128 from "../../../images/elf_128.webp";
import elf_512 from "../../../images/elf_512.webp";
import satyr_128 from "../../../images/satyr_128.webp";
import satyr_512 from "../../../images/satyr_512.webp";
import unicorn_128 from "../../../images/unicorn_128.webp";
import unicorn_512 from "../../../images/unicorn_512.webp";
import phoenix_256 from "../../../images/phoenix_256.webp";
import phoenix_512 from "../../../images/phoenix_512.webp";
import faerie_dragon_256 from "../../../images/faerie_dragon_256.webp";
import faerie_dragon_512 from "../../../images/faerie_dragon_512.webp";
import gargantuan_256 from "../../../images/gargantuan_256.webp";
import gargantuan_512 from "../../../images/gargantuan_512.webp";
import scavenger_128 from "../../../images/scavenger_128.webp";
import scavenger_512 from "../../../images/scavenger_512.webp";
import orc_128 from "../../../images/orc_128.webp";
import orc_512 from "../../../images/orc_512.webp";
import troglodyte_128 from "../../../images/troglodyte_128.webp";
import troglodyte_512 from "../../../images/troglodyte_512.webp";
import medusa_128 from "../../../images/medusa_128.webp";
import medusa_512 from "../../../images/medusa_512.webp";
import troll_128 from "../../../images/troll_128.webp";
import troll_512 from "../../../images/troll_512.webp";
import beholder_128 from "../../../images/beholder_128.webp";
import beholder_512 from "../../../images/beholder_512.webp";
import efreet_128 from "../../../images/efreet_128.webp";
import efreet_512 from "../../../images/efreet_512.webp";
import goblin_knight_128 from "../../../images/goblin_knight_128.webp";
import goblin_knight_512 from "../../../images/goblin_knight_512.webp";
import black_dragon_256 from "../../../images/black_dragon_256.webp";
import black_dragon_512 from "../../../images/black_dragon_512.webp";
import hydra_256 from "../../../images/hydra_256.webp";
import hydra_512 from "../../../images/hydra_512.webp";
import skeleton_128 from "../../../images/skeleton_128.webp";
import skeleton_512 from "../../../images/skeleton_512.webp";
import imp_128 from "../../../images/imp_128.webp";
import imp_512 from "../../../images/imp_512.webp";
import zombie_128 from "../../../images/zombie_128.webp";
import zombie_512 from "../../../images/zombie_512.webp";
import dark_champion_256 from "../../../images/dark_champion_256.webp";
import dark_champion_512 from "../../../images/dark_champion_512.webp";
import berserker_128 from "../../../images/berserker_128.webp";
import berserker_512 from "../../../images/berserker_512.webp";
import centaur_128 from "../../../images/centaur_128.webp";
import centaur_512 from "../../../images/centaur_512.webp";
import wolf_rider_128 from "../../../images/wolf_rider_128.webp";
import wolf_rider_512 from "../../../images/wolf_rider_512.webp";
import nomad_128 from "../../../images/nomad_128.webp";
import nomad_512 from "../../../images/nomad_512.webp";
import harpy_128 from "../../../images/harpy_128.webp";
import harpy_512 from "../../../images/harpy_512.webp";
import ogre_mage_128 from "../../../images/ogre_mage_128.webp";
import ogre_mage_512 from "../../../images/ogre_mage_512.webp";
import cyclops_128 from "../../../images/cyclops_128.webp";
import cyclops_512 from "../../../images/cyclops_512.webp";
import thunderbird_256 from "../../../images/thunderbird_256.webp";
import thunderbird_512 from "../../../images/thunderbird_512.webp";
import behemoth_256 from "../../../images/behemoth_256.webp";
import behemoth_512 from "../../../images/behemoth_512.webp";
import range_black_128 from "../../../images/range_black_128.webp";
import range_white_128 from "../../../images/range_white_128.webp";
import melee_white_128 from "../../../images/melee_white_128.webp";
import melee_black_128 from "../../../images/melee_black_128.webp";
import magic_white_128 from "../../../images/magic_white_128.webp";
import magic_black_128 from "../../../images/magic_black_128.webp";
import hourglass_black_128 from "../../../images/hourglass_black_128.webp";
import hourglass_white_128 from "../../../images/hourglass_white_128.webp";
import ai_black_128 from "../../../images/ai_black_128.webp";
import ai_white_128 from "../../../images/ai_white_128.webp";
import ai_active_128 from "../../../images/ai_active_128.webp";
import shield_black_128 from "../../../images/shield_black_128.webp";
import shield_white_128 from "../../../images/shield_white_128.webp";
import next_black_128 from "../../../images/next_black_128.webp";
import next_white_128 from "../../../images/next_white_128.webp";
import spellbook_black_128 from "../../../images/spellbook_black_128.webp";
import spellbook_white_128 from "../../../images/spellbook_white_128.webp";
import totel_of_courage_256 from "../../../images/totel_of_courage_256.webp";
import helping_hand_256 from "../../../images/helping_hand_256.webp";
import summon_wolves_256 from "../../../images/summon_wolves_256.webp";
import up_next_black_font from "../../../images/up_next_black_font.webp";
import up_next_white_font from "../../../images/up_next_white_font.webp";
import helping_hand_font from "../../../images/helping_hand_font.webp";
import summon_wolves_font from "../../../images/summon_wolves_font.webp";
import totem_of_courage_font from "../../../images/totem_of_courage_font.webp";
import abilities_white_font from "../../../images/abilities_white_font.webp";
import buffs_white_font from "../../../images/buffs_white_font.webp";
import debuffs_white_font from "../../../images/debuffs_white_font.webp";
import zero_white from "../../../images/0_white.webp";
import one_white from "../../../images/1_white.webp";
import two_white from "../../../images/2_white.webp";
import three_white from "../../../images/3_white.webp";
import four_white from "../../../images/4_white.webp";
import five_white from "../../../images/5_white.webp";
import six_white from "../../../images/6_white.webp";
import seven_white from "../../../images/7_white.webp";
import eight_white from "../../../images/8_white.webp";
import nine_white from "../../../images/9_white.webp";
import damage from "../../../images/damage.webp";
import m_damage from "../../../images/m_damage.webp";
import zero_damage from "../../../images/0_damage.webp";
import one_damage from "../../../images/1_damage.webp";
import two_damage from "../../../images/2_damage.webp";
import three_damage from "../../../images/3_damage.webp";
import four_damage from "../../../images/4_damage.webp";
import five_damage from "../../../images/5_damage.webp";
import six_damage from "../../../images/6_damage.webp";
import seven_damage from "../../../images/7_damage.webp";
import eight_damage from "../../../images/8_damage.webp";
import nine_damage from "../../../images/9_damage.webp";
import tag from "../../../images/tag.webp";
import hourglass from "../../../images/hourglass.webp";
import mountain_432_412 from "../../../images/mountain_432_412.webp";
import lava_256 from "../../../images/lava_256.webp";
import water_256 from "../../../images/water_256.webp";
import spacehole_1 from "../../../images/spacehole_1.webp";
import spacehole_2 from "../../../images/spacehole_2.webp";
import spacehole_3 from "../../../images/spacehole_3.webp";
import spacehole_4 from "../../../images/spacehole_4.webp";
import spacehole_5 from "../../../images/spacehole_5.webp";

const preloadMap = {
    book_1024,
    back,
    frame_black_512,
    green_flag_70,
    red_flag_70,
    green_flag_128,
    red_flag_128,
    life_128,
    nature_128,
    order_128,
    might_128,
    chaos_128,
    death_128,
    death_locked_128,
    life_512,
    nature_512,
    order_512,
    might_512,
    chaos_512,
    death_512,
    double_punch_256,
    backstab_256,
    double_shot_256,
    sniper_256,
    leather_armor_256,
    limited_supply_256,
    undead_256,
    made_of_bones_256,
    taxpayer_256,
    fire_vulnerability_256,
    luck_aura_256,
    fire_element_256,
    stun_256,
    handyman_256,
    endless_quiver_256,
    one_in_the_field_256,
    shadow_touch_256,
    wild_regeneration_256,
    enchanted_skin_256,
    lightning_spin_256,
    fire_breath_256,
    fire_shield_256,
    small_specie_256,
    boost_health_256,
    piercing_spear_256,
    heavy_armor_256,
    no_melee_256,
    arbalester_128,
    arbalester_512,
    squire_128,
    squire_512,
    peasant_128,
    peasant_512,
    pikeman_128,
    pikeman_512,
    griffin_128,
    griffin_512,
    crusader_128,
    crusader_512,
    tsar_cannon_256,
    tsar_cannon_512,
    angel_256,
    angel_512,
    fairy_128,
    fairy_512,
    wolf_128,
    wolf_512,
    leprechaun_128,
    leprechaun_512,
    white_tiger_128,
    white_tiger_512,
    elf_128,
    elf_512,
    satyr_128,
    satyr_512,
    unicorn_128,
    unicorn_512,
    phoenix_256,
    phoenix_512,
    faerie_dragon_256,
    faerie_dragon_512,
    gargantuan_256,
    gargantuan_512,
    scavenger_128,
    scavenger_512,
    orc_128,
    orc_512,
    troglodyte_128,
    troglodyte_512,
    medusa_128,
    medusa_512,
    troll_128,
    troll_512,
    beholder_128,
    beholder_512,
    efreet_128,
    efreet_512,
    goblin_knight_128,
    goblin_knight_512,
    black_dragon_256,
    black_dragon_512,
    hydra_256,
    hydra_512,
    skeleton_128,
    skeleton_512,
    imp_128,
    imp_512,
    zombie_128,
    zombie_512,
    dark_champion_256,
    dark_champion_512,
    berserker_128,
    berserker_512,
    centaur_128,
    centaur_512,
    wolf_rider_128,
    wolf_rider_512,
    nomad_128,
    nomad_512,
    harpy_128,
    harpy_512,
    ogre_mage_128,
    ogre_mage_512,
    cyclops_128,
    cyclops_512,
    thunderbird_256,
    thunderbird_512,
    behemoth_256,
    behemoth_512,
    range_black_128,
    range_white_128,
    melee_black_128,
    melee_white_128,
    magic_black_128,
    magic_white_128,
    hourglass_black_128,
    hourglass_white_128,
    ai_black_128,
    ai_white_128,
    ai_active_128,
    shield_black_128,
    shield_white_128,
    next_black_128,
    next_white_128,
    spellbook_black_128,
    spellbook_white_128,
    totel_of_courage_256,
    abilities_white_font,
    buffs_white_font,
    debuffs_white_font,
    helping_hand_256,
    summon_wolves_256,
    up_next_white_font,
    up_next_black_font,
    helping_hand_font,
    totem_of_courage_font,
    summon_wolves_font,
    zero_white,
    one_white,
    two_white,
    three_white,
    four_white,
    five_white,
    six_white,
    seven_white,
    eight_white,
    nine_white,
    damage,
    m_damage,
    zero_damage,
    one_damage,
    two_damage,
    three_damage,
    four_damage,
    five_damage,
    six_damage,
    seven_damage,
    eight_damage,
    nine_damage,
    tag,
    hourglass,
    mountain_432_412,
    lava_256,
    water_256,
    spacehole_1,
    spacehole_2,
    spacehole_3,
    spacehole_4,
    spacehole_5,
};

export interface TextureInfo {
    width: number;
    height: number;
    texture: WebGLTexture;
}

export async function loadImages<T extends { [s: string]: string }>(gl: WebGLRenderingContext, imagesToLoad: T) {
    const textures = {} as { [key in keyof T]: TextureInfo };
    const imagePromises = Object.keys(imagesToLoad).map(
        (key) =>
            new Promise<void>((resolve) => {
                const texture = gl.createTexture() as WebGLTexture;
                gl.bindTexture(gl.TEXTURE_2D, texture);
                // let's assume all images are not a power of 2
                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
                gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.LINEAR);

                const image = new Image();
                const textureInfo: TextureInfo = {
                    width: 0,
                    height: 0,
                    texture,
                };
                image.onload = () => {
                    textureInfo.width = image.width;
                    textureInfo.height = image.height;
                    gl.bindTexture(gl.TEXTURE_2D, texture);
                    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);
                    resolve();
                };
                image.src = imagesToLoad[key as keyof T];
                textures[key as keyof T] = textureInfo;
            }),
    );
    await Promise.all(imagePromises);
    return textures;
}

export const preloadTextures = (gl: WebGLRenderingContext) => loadImages(gl, preloadMap);

export type PromiseType<T> = T extends Promise<infer TR> ? TR : unknown;

export type PreloadedTextures = PromiseType<ReturnType<typeof preloadTextures>>;
